<!-- templates/wizard/wizard_base.html -->
{% extends "base.html" %}
{% load static %}

{% block extra_css %}
  {{ block.super }}
  <!-- demo overrides -->
  <link href="{% static 'css/demo.css' %}" rel="stylesheet" />
  <!-- Custom wizard styles -->
  <link href="{% static 'css/wizard.css' %}" rel="stylesheet" />
  <style>
    /* Additional styles for the moving tab */
    .moving-tab {
      position: absolute;
      padding: 10px 15px;
      color: #fff;
      background-color: #007bff;
      border-radius: 4px;
      box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);
      text-align: center;
      font-weight: 500;
      z-index: 1;
      transition: all 0.3s ease;
    }
  </style>
{% endblock %}

{% block content %}
<div class="content">
  <div class="col-md-10 mx-auto">
    <!-- Debug information at top of page -->
    <div style="background-color: #f8f9fa; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
      <strong>Debug Info:</strong>
      <pre>current_step: {{ current_step }}
step_data: {% if step_data %}Available{% else %}None{% endif %}
wizard_data: {% if wizard_data %}Available{% else %}None{% endif %}
back_enabled: {{ back_enabled }}
has_courses: {{ has_courses|default:"Not set" }}</pre>
    </div>
    
    <div class="wizard-container">
      <div class="card card-wizard" data-color="primary" id="wizardSync">
        <form id="sync-wizard-form" method="post" action="{% url 'wizard_main' %}">
          {% csrf_token %}
          <!-- Header -->
          <div class="card-header text-center">
            <h3 class="card-title">Canvas Group to Core Team Sync</h3>
            <h5 class="description">Follow the steps to complete synchronization</h5>
            <div class="wizard-navigation">
              <ul class="nav nav-pills">
                {% for label in progress_labels %}
                  <li class="nav-item">
                    <a class="nav-link {% if forloop.counter == current_step %}active{% endif %}"
                       href="#step{{ forloop.counter }}"
                       data-bs-toggle="tab"
                       role="tab"
                       aria-controls="step{{ forloop.counter }}"
                       aria-selected="{% if forloop.counter == current_step %}true{% else %}false{% endif %}">
                      {{ label }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>

          <!-- Body -->
          <div class="card-body">
            <div class="tab-content">
              {% block step_content %}{% endblock %}
            </div>
          </div>

          <!-- Footer Buttons -->
          <div class="card-footer">
            <div class="float-start">
              <button type="button"
                      id="previous-btn"
                      class="btn btn-previous btn-fill btn-default btn-wd"
                      {% if not back_enabled %}disabled{% endif %}>
                Previous
              </button>
              
              <button type="button"
                      id="reset-btn"
                      class="btn btn-fill btn-warning btn-wd ms-2">
                Restart Wizard
              </button>
            </div>
            <div class="float-end">
              <button type="button"
                      id="next-btn"
                      class="btn btn-next btn-fill btn-primary btn-wd">
                Next
              </button>
              <button type="submit"
                      id="finish-btn"
                      class="btn btn-finish btn-fill btn-primary btn-wd"
                      style="display: none;">
                Finish
              </button>
            </div>
            <div class="clearfix"></div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_head %}
  <!-- Load jQuery in the head to ensure it's available before any scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  
  <!-- Debug script to verify jQuery loaded -->
  <script>
    console.log("[HEAD] jQuery loaded: " + (typeof jQuery !== 'undefined'));
    if (typeof jQuery !== 'undefined') {
      console.log("[HEAD] jQuery version: " + jQuery.fn.jquery);
    }
    
    // Add boolean values to avoid any True/False conversion issues
    window.jsTrue = true;
    window.jsFalse = false;
    
    // Define Python True/False as JavaScript true/false to prevent errors
    window.True = window.jsTrue;
    window.False = window.jsFalse;
  </script>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  
  <!-- Debug compatibility -->
  <script>
    console.log("=== DEBUG SCRIPT LOADING ===");
    console.log("jQuery available in extra_js: " + (typeof jQuery !== 'undefined'));
    if (typeof jQuery !== 'undefined') {
      console.log("jQuery version: " + jQuery.fn.jquery);
    }
    
    if (typeof bootstrap !== 'undefined') {
      console.log("Bootstrap version: " + bootstrap.Tooltip.VERSION);
    } else {
      console.log("Bootstrap not yet loaded");
    }
    
    // Attempt to detect conflicts or issues
    if (typeof $ !== 'undefined' && typeof jQuery !== 'undefined' && $ !== jQuery) {
      console.error("$ and jQuery are different objects - potential conflict!");
    }
    console.log("===========================");
  </script>
  
  <!-- Bootstrap 5 bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

  <!-- Second check after Bootstrap loads -->
  <script>
    console.log("=== AFTER BOOTSTRAP LOAD ===");
    console.log("Bootstrap version: " + (typeof bootstrap !== 'undefined' ? bootstrap.Tooltip.VERSION : "not loaded"));
    
    // Initialize all tooltips and popovers
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof bootstrap !== 'undefined') {
        // Enable tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Initialize tabs manually to ensure they work
        var tabElements = document.querySelectorAll('[data-bs-toggle="tab"]');
        console.log("Found " + tabElements.length + " tab elements to initialize");
        tabElements.forEach(function(tabEl) {
          new bootstrap.Tab(tabEl);
        });
      }
    });
    console.log("===========================");
  </script>
  
  <!-- Form validation -->
  <script src="{% static 'js/plugins/jquery.validate.min.js' %}"></script>
  
  <!-- Your custom wizard logic will be loaded last -->
  <script src="{% static 'js/wizard.js' %}"></script>
{% endblock %}
