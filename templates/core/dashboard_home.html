{% extends 'base_dashboard.html' %}

{% block title %}Dashboard - GradeBench{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block nav_dashboard %}active{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-3 col-md-6 col-sm-6">
        <div class="card card-stats">
            <div class="card-body">
                <div class="row">
                    <div class="col-5 col-md-4">
                        <div class="icon-big text-center icon-warning">
                            <i class="nc-icon nc-globe text-warning"></i>
                        </div>
                    </div>
                    <div class="col-7 col-md-8">
                        <div class="numbers">
                            <p class="card-category">Repositories</p>
                            <p class="card-title">5</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <hr>
                <div class="stats">
                    <i class="fa fa-refresh"></i> Updated Now
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6">
        <div class="card card-stats">
            <div class="card-body">
                <div class="row">
                    <div class="col-5 col-md-4">
                        <div class="icon-big text-center icon-warning">
                            <i class="nc-icon nc-vector text-success"></i>
                        </div>
                    </div>
                    <div class="col-7 col-md-8">
                        <div class="numbers">
                            <p class="card-category">Commits</p>
                            <p class="card-title">128</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <hr>
                <div class="stats">
                    <i class="fa fa-calendar-o"></i> Last 7 days
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6">
        <div class="card card-stats">
            <div class="card-body">
                <div class="row">
                    <div class="col-5 col-md-4">
                        <div class="icon-big text-center icon-warning">
                            <i class="nc-icon nc-favourite-28 text-primary"></i>
                        </div>
                    </div>
                    <div class="col-7 col-md-8">
                        <div class="numbers">
                            <p class="card-category">Grade</p>
                            <p class="card-title">92.5%</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <hr>
                <div class="stats">
                    <i class="fa fa-clock-o"></i> Current Average
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6">
        <div class="card card-stats">
            <div class="card-body">
                <div class="row">
                    <div class="col-5 col-md-4">
                        <div class="icon-big text-center icon-warning">
                            <i class="nc-icon nc-ruler-pencil text-danger"></i>
                        </div>
                    </div>
                    <div class="col-7 col-md-8">
                        <div class="numbers">
                            <p class="card-category">Assignments</p>
                            <p class="card-title">8</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <hr>
                <div class="stats">
                    <i class="fa fa-refresh"></i> Total Count
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Commit Activity</h4>
                <p class="card-category">All repositories over time</p>
            </div>
            <div class="card-body">
                <canvas id="commitActivityChart" width="400" height="200"></canvas>
            </div>
            <div class="card-footer">
                <hr>
                <div class="stats">
                    <i class="fa fa-history"></i> Updated daily
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Repository Breakdown</h4>
                <p class="card-category">Commits by Repository</p>
            </div>
            <div class="card-body">
                <canvas id="repoBreakdownChart" width="400" height="300"></canvas>
            </div>
            <div class="card-footer">
                <div class="legend">
                    <i class="fa fa-circle text-primary"></i> Repo1
                    <i class="fa fa-circle text-warning"></i> Repo2
                    <i class="fa fa-circle text-danger"></i> Repo3
                    <i class="fa fa-circle text-success"></i> Repo4
                </div>
                <hr>
                <div class="stats">
                    <i class="fa fa-check"></i> Data updated daily
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Recent Activity</h4>
                <p class="card-category">Latest commits and changes</p>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead class="text-primary">
                            <tr>
                                <th>Repository</th>
                                <th>Commit</th>
                                <th>Author</th>
                                <th class="text-right">Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Repository 1</td>
                                <td>Fix bug in authentication module</td>
                                <td>{{ user.get_full_name|default:user.username }}</td>
                                <td class="text-right">2 days ago</td>
                            </tr>
                            <tr>
                                <td>Repository 2</td>
                                <td>Update documentation</td>
                                <td>{{ user.get_full_name|default:user.username }}</td>
                                <td class="text-right">3 days ago</td>
                            </tr>
                            <tr>
                                <td>Repository 1</td>
                                <td>Implement new features</td>
                                <td>{{ user.get_full_name|default:user.username }}</td>
                                <td class="text-right">5 days ago</td>
                            </tr>
                            <tr>
                                <td>Repository 3</td>
                                <td>Initial commit</td>
                                <td>{{ user.get_full_name|default:user.username }}</td>
                                <td class="text-right">1 week ago</td>
                            </tr>
                            <tr>
                                <td>Repository 2</td>
                                <td>Setup project structure</td>
                                <td>{{ user.get_full_name|default:user.username }}</td>
                                <td class="text-right">1 week ago</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Commit Activity Chart (Line Chart)
        var ctxCommit = document.getElementById('commitActivityChart').getContext('2d');
        var commitActivityChart = new Chart(ctxCommit, {
            type: 'line',
            data: {
                labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
                datasets: [{
                    label: 'Commits',
                    data: [12, 19, 3, 5, 2, 3, 20],
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Repository Breakdown Chart (Doughnut Chart)
        var ctxRepo = document.getElementById('repoBreakdownChart').getContext('2d');
        var repoBreakdownChart = new Chart(ctxRepo, {
            type: 'doughnut',
            data: {
                labels: ['Repo1', 'Repo2', 'Repo3', 'Repo4'],
                datasets: [{
                    label: 'Commits',
                    data: [45, 25, 20, 10],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 206, 86, 0.8)',
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(75, 192, 192, 0.8)'
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
        
        // Fetch GitHub profile data
        async function fetchGitHubProfile() {
            try {
                const response = await fetch('/api/github-profile/');
                const data = await response.json();
                
                if (data.error) {
                    console.error('Error fetching GitHub profile:', data.error);
                } else {
                    console.log('GitHub profile data:', data);
                    // Update UI with GitHub data if needed
                }
            } catch (error) {
                console.error('Failed to fetch GitHub profile:', error);
            }
        }
        
        // Call the function when the page loads
        fetchGitHubProfile();
    });
</script>
{% endblock %}